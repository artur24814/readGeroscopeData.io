<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Żyroskop</title>
    <style>
        body {
            font-family: Arial, sans-serif;
        }
        .info {
            font-size: 1.5em;
            margin-bottom: 10px;
        }
    </style>
</head>
<body>
    <h1>Dane z żyroskopu urządzenia</h1>
    <div class="info">Alfa: <span id="alpha"></span></div>
    <div class="info">Beta: <span id="beta"></span></div>
    <div class="info">Gamma: <span id="gamma"></span></div>
    
    <button id='start-camera'>start</button>
    <video id="video" width="320" height="240" autoplay></video>
    <button id="start-record">Start Recording</button>
    <button id="stop-record">Stop Recording</button>
    <a id="download-video" download="test.webm">Download Video</a>

    <script>
        let camera_button = document.querySelector("#start-camera");
        // camera
        
        
        let video = document.querySelector("#video");
        let start_button = document.querySelector("#start-record");
        let stop_button = document.querySelector("#stop-record");
        let download_link = document.querySelector("#download-video");

        let camera_stream = null;
        let media_recorder = null;
        let blobs_recorded = [];


        stop_button.addEventListener('click', function() {
            media_recorder.stop(); 
        });
        
        camera_button.addEventListener('click', async function() {
            camera_stream = await navigator.mediaDevices.getUserMedia({ 
                video: {
                facingMode: 'environment'
                }, audio: true });
            video.srcObject = camera_stream;
        });

        camera_button.addEventListener('click', requestDeviceOrientation) 
        
        
        function requestDeviceOrientation () {
        if (typeof DeviceOrientationEvent !== 'undefined' && typeof DeviceOrientationEvent.requestPermission === 'function') {
          DeviceOrientationEvent.requestPermission()
          .then(permissionState => {
          if (permissionState === 'granted') {
          window.addEventListener("deviceorientation", function(event) {
                document.getElementById("alpha").innerHTML = event.alpha.toFixed(2);
                document.getElementById("beta").innerHTML = event.beta.toFixed(2);
                document.getElementById("gamma").innerHTML = event.gamma.toFixed(2);
            }, false);
          }
          })
          .catch(console.error);
          } else {
              window.addEventListener("deviceorientation", function(event) {
                document.getElementById("alpha").innerHTML = event.alpha.toFixed(2);
                document.getElementById("beta").innerHTML = event.beta.toFixed(2);
                document.getElementById("gamma").innerHTML = event.gamma.toFixed(2);
            }, false);
          console.log ("not iOS");
          }
             // set MIME type of recording as video/webm
            media_recorder = new MediaRecorder(camera_stream, { mimeType: 'video/webm' });

            // event : new recorded video blob available 
            media_recorder.addEventListener('dataavailable', function(e) {
                blobs_recorded.push(e.data);
            });

            // event : recording stopped & all blobs sent
            media_recorder.addEventListener('stop', function() {
                // create local object URL from the recorded video blobs
                let video_local = URL.createObjectURL(new Blob(blobs_recorded, { type: 'video/webm' }));
                download_link.href = video_local;
            });

            // start recording with each recorded blob having 1 second video
            media_recorder.start(1000);
            
        }
        
        
    </script>
</body>
</html>
